===============================================================
 BlackTank LPC1769
===============================================================

 BlackTank LPC1769はARM Cortex-M3とRTOSを楽しむ事を目的に設計
 した基板です。
 有機ELディスプレイ、４系統ユーザ入力、オーディオコーデック、
 マイクロSDカードなどが１枚の基板に搭載されています。
 ARM Cortex-M3にはNXP SemiconductorsのLPC1769を採用しています。

 また、基板サイズはユニバーサル基板(ここに型名)と同じです。
 実験回路をユニバーサル基板に実装して、ドッキングして使用する
 こともできます。

===============================================================
 ハードウェア設計のポイント
===============================================================

* 人間の特性を考慮すると良い。
  -> 人間は適度な量の入力情報を必要とする。
  -> 人間は沢山の操作をすることができない。

===============================================================
 ファームウェア設計のポイント
===============================================================

* 基本的にイベントドリブンモデルを採用する。
* 出力デバイスに関するタスクはサービスの実装をマクロで隠蔽する。

===============================================================
 タスク設計
===============================================================

1. ユーザインプットタスク(task_userinput)
 ユーザインプットタスクは４系統のユーザ入力の変化を観察する
 タスクです。
 変化があればデータキューを介してシステムコントロールタスクに
 通知されます。

2. メニュータスク(task_menu)
 メニュータスクはユーザにシステムのサービスを提示し、
 ユーザからの要求をシステムに伝達する役目を果たします。

 ユーザからの要求は各タスクから次のマクロのみで指示することができます。
 USERMSG(device, value);

 deviceは以下から選択できます。
 スイッチ: SW0, SW1, SW2, SW3
 ボリューム: VOL0, VOL1, VOL2, VOL3

 valueは以下から選択できます。
 0から63の整数

 このタスクへの指示はデータキューを介して行われます。
 データキュー内部データ構造は以下のようになっています。

 +---+---+---+---+---+---+---+---+-------------+
 | 7 | 6 | 5 | 4 | 3 | 2 | 1 | 0 | Description |
 +---+---+---+---+---+---+---+---+-------------+
 |           |<-     [4:0]     ->| Value       |
 +---+---+---+---+---+---+---+---+-------------+
 | <-[7:5]-> |                   | Device      |
 +---+---+---+---+---+---+---+---+-------------+

3. LEDタスク(task_led)
 LEDタスクはLEDの点灯を制御するタスクです。

 点灯は各タスクから次のマクロのみで指示することができます。
 LEDMSG(target, control);

 targetは以下から選択できます。
 デバッグ用LED: DBLED0, DBLED1, DBLED2, DBLED3
 スイッチ用LED: SWLED0, SWLED1, SWLED2, SWLED3

 controlは以下から選択できます。
 LED点灯：LEDON
 LED消灯：LEDOFF

 このタスクへの指示はデータキューを介して行われます。
 データキュー内部データ構造は以下のようになっています。

 +---+---+---+---+---+---+---+---+-------------+
 | 7 | 6 | 5 | 4 | 3 | 2 | 1 | 0 | Description |
 +---+---+---+---+---+---+---+---+-------------+
 |               |<-   [3:0]   ->| Target      |
 +---+---+---+---+---+---+---+---+-------------+
 |   | x   x   x |               | Reserved    |
 +---+---+---+---+---+---+---+---+-------------+
 |[7]|                           | Control     |
 +---+---+---+---+---+---+---+---+-------------+

4. ディスプレイタスク(task_display)
 ディスプレイタスクは有機ELディスプレイを制御するタスクです。

 ディスプレイの制御は以下のマクロを使って行うことができます。

 DISP_CLEAR(r, g, b);
 DISP_LINE(x1, y1, x2, y2, r, g, b);
 DISP_BOX(x1, y1, x2, y2, r, g, b);
 DISP_FILLBOX(x1, y1, x2, y2, r1, g1, b1, r2, g2, b2);
 DISP_TEXT(x, y, r, g, b, "text");

 タスク間はメールボックスでやりとりされます。
 マクロはこれを隠蔽した実装としました。
 メールボックスで陥りがちな同期問題を未然に防ぐ対策として
 メモリプール管理機能を使ってデータ領域に対するアクセスを
 管理しています。

 今回の実装では受信側が処理を完了するまで送信側が次の処理に
 遷移しない実装にしてあります。
 今回のタスク設計ではメニュータスクがブロックの対象となります。

5. ナチュラルタイニーシェルタスク(task_ntshell)
 システムをコンソールから制御することのできるインターフェース
 タスクです。

6. オーディオ初期化タスク(task_audio_init)
 オーディオを初期化するためのタスクです。

===============================================================
 アプリケーション例
===============================================================

* オーディオエフェクタ
* ピンボールゲーム

===============================================================
 プライオリティ
===============================================================

* ユーザ入力タスクはディスプレイタスクより優先度が高い必要がある。
  表示処理中にユーザ入力があっても処理できる必要があるためである。

===============================================================
 使用上の注意
===============================================================

* OLEDは同じ内容を表示し続けると焼き付きが発生します。
  -> 表示内容を時折変更するようにして下さい。

===============================================================
 基板に関する既知の問題点と対応案
===============================================================

* OLEDの電源配線ミス。
  -> 電源の配線を追加する。

* スイッチの感触が個体によって異なるので他のスイッチにしたい。
  -> 

* レギュレータのGNDの配線が細い。
  -> 配線を太く、短くする。

* 基板名やリビジョン、スペシャルサンクスのシルクが入っていない。
  -> レイヤーを間違ってる？

* RESET, ISPのシルクが入っていない。
  -> レイヤーを間違ってる？

* オーディオコネクタのどれが何かわからない。シルクを入れたい。
  -> 場所がない。
  -> アクリルに入れるか。

* デバッグ用LEDが眩しすぎる。意図して高輝度LEDだが、眩しすぎ！
  -> 抵抗値を変更する。

* 通信確認LEDが暗い。
  -> デバッグ用LEDに採用したLEDと同じ物を使う。

* スイッチが微妙な基板端に配置されていてカバーアクリルを作りづらい。
  -> 基板端にするならする。しないなら離す。

* OLEDのノイズ音が気になる。
  -> 初期化パラメータの動作周波数変更で回避可能か？

* OLEDに書き込みを行うとオーディオにノイズが発生する。
  -> 配線がよくない。
  -> 配置がよくない。

* UART2がネジ穴に近すぎる。
  -> もう少し離して配置したい。

* JTAGコネクタがネジ穴に近い。
  -> もう少し離して配置したい。

* 発振器のパッケージを見直したい。
  -> 小さいパッケージの中ではどれが一般的？

* ボリュームではなく、ロータリーエンコーダにしたい。
  -> クルクル回したい。

* TP1, TP2の位置が使いづらい。
  -> 配線の都合上？


